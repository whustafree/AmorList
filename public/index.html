<!DOCTYPE html>
<html lang="es">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Para la Kote ❤️</title>
    <link href="https://fonts.googleapis.com/css2?family=Montserrat:wght@400;600;800&display=swap" rel="stylesheet">
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css">
    <style>
        * { margin: 0; padding: 0; box-sizing: border-box; }
        body { background-color: #121212; color: white; font-family: 'Montserrat', sans-serif; height: 100vh; display: flex; flex-direction: column; overflow: hidden; }
        .main-container { display: flex; flex: 1; overflow: hidden; background: linear-gradient(180deg, #2a0a12 0%, #121212 40%); }
        .content { flex: 1; padding: 20px; overflow-y: auto; text-align: center; }
        .hero img { width: 200px; height: 200px; border-radius: 10px; box-shadow: 0 4px 60px rgba(0,0,0,0.5); object-fit: cover; margin-bottom: 20px; }
        .hero h1 { font-size: 28px; font-weight: 800; margin-bottom: 10px; }
        .track-list { width: 100%; margin-top: 20px; text-align: left; border-collapse: collapse; }
        .track-row { height: 50px; cursor: pointer; border-bottom: 1px solid #333; }
        .track-row:hover { background: rgba(255,255,255,0.1); }
        .track-row td { padding: 0 10px; }
        .track-row.active { color: #ff4d6d; }
        .player-bar { height: 80px; background: #181818; display: flex; align-items: center; justify-content: space-between; padding: 0 20px; border-top: 1px solid #333; }
        .controls button { background: none; border: none; color: white; font-size: 20px; margin: 0 10px; cursor: pointer; }
        .controls button:hover { color: #ff4d6d; }
    </style>
</head>
<body>
    <div class="main-container">
        <main class="content">
            <div class="hero">
                <img src="https://via.placeholder.com/200" id="hero-img">
                <h1>Para mi Kote ❤️</h1>
                <p>Nuestra música favorita</p>
            </div>
            <table class="track-list">
                <tbody id="playlist-body">
                    <tr><td>Cargando canciones...</td></tr>
                </tbody>
            </table>
        </main>
    </div>
    <div class="player-bar">
        <div id="current-title" style="font-size: 14px;">Selecciona una canción</div>
        <div class="controls">
            <button onclick="prevTrack()"><i class="fa-solid fa-backward"></i></button>
            <button onclick="togglePlay()"><i class="fa-solid fa-play" id="play-icon"></i></button>
            <button onclick="nextTrack()"><i class="fa-solid fa-forward"></i></button>
        </div>
    </div>

    <script>
        let songs = [];
        let currentIndex = 0;
        const audio = new Audio();
        
        async function loadMusic() {
            try {
                const res = await fetch('/api/music');
                const data = await res.json();
                if(data.length) { 
                    songs = data; 
                    renderList(); 
                    loadTrack(0); 
                } else { document.getElementById('playlist-body').innerHTML = '<tr><td>No encontré música :(</td></tr>'; }
            } catch (e) { console.error(e); }
        }

        function renderList() {
            const tbody = document.getElementById('playlist-body');
            tbody.innerHTML = '';
            songs.forEach((s, i) => {
                const tr = document.createElement('tr');
                tr.className = 'track-row';
                tr.onclick = () => playTrack(i);
                tr.innerHTML = `<td>${i+1}</td><td>${s.title}</td>`;
                tbody.appendChild(tr);
            });
        }

        function loadTrack(i) {
            document.getElementById('hero-img').src = songs[i].cover;
            document.getElementById('current-title').innerText = songs[i].title;
            audio.src = songs[i].src;
        }

        function playTrack(i) {
            currentIndex = i;
            loadTrack(i);
            audio.play();
            document.getElementById('play-icon').className = 'fa-solid fa-pause';
        }

        function togglePlay() {
            if(audio.paused) { audio.play(); document.getElementById('play-icon').className = 'fa-solid fa-pause'; }
            else { audio.pause(); document.getElementById('play-icon').className = 'fa-solid fa-play'; }
        }
        
        function nextTrack() { playTrack((currentIndex + 1) % songs.length); }
        function prevTrack() { playTrack((currentIndex - 1 + songs.length) % songs.length); }

        window.onload = loadMusic;
    </script>
</body>
</html>
